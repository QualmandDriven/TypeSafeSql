flowchart LR

Root -->|With| WithTable
Root -->|With| With

subgraph IWith
    With -->|Recursive| Recursive
    Recursive -->|As| WithAs
    WithTable -->|As| WithAs
    WithAs --> |Not| WithNot
    WithNot --> |Materialized| Materialized
    WithAs --> |Materialized| Materialized

    WithAs --> |With| WithAdditionalTable
    Materialized -->|With| WithAdditionalTable

    WithAs --> IWithEnd
    Materialized --> IWithEnd
end


Root -->|Select| Select
Root -->|Select| SelectColumns

subgraph ISelect
    Select -->|All| All
    Distinct --> |All| All

    Select -->|Distinct| Distinct
    Select -->|Distinct| DistinctColumns

    SelectColumns -->|From| From
    All --> |From| From
    DistinctColumns --> |From| From

    subgraph IJoin
        From -->|CrossJoin| NonConditionalJoin
        ConditionalJoin -->|On| On
        ConditionalJoin -->|On| OnMulti

        NonConditionalJoin --> IJoinEnd
        On --> IJoinEnd
        OnMulti --> IJoinEnd
    end
    
    From -->|InnerJoin| ConditionalJoin
    From -->|LeftJoin| ConditionalJoin
    From -->|RightJoin| ConditionalJoin
    From -->|FullJoin| ConditionalJoin

    subgraph IWhere
        Where
        WhereGroup

        Where --> IWhereEnd
        WhereGroup --> IWhereEnd
    end

    IJoin -->|Where| IWhere
    IJoin -->|GroupBy| GroupBy
    IWhere -->|GroupBy| GroupBy
    GroupBy -->|Having| Having
    IWhere -->|Having| Having

    From --> ISelectEnd
    IJoin --> ISelectEnd
    IWhere --> ISelectEnd
    GroupBy --> ISelectEnd
    Having --> ISelectEnd
end

//ISelect -->|Union| ISelect
//ISelect -->|UnionAll| ISelect
//ISelect -->|Intersect| ISelect
//ISelect -->|Except| ISelect

subgraph IOrderBy
    OrderBy --> IOrderByEnd
    OrderBy -->|Collate| Collate
    Collate --> IOrderByEnd
    OrderBy -->|Asc| Asc
    Collate -->|Asc| Asc
    Asc --> IOrderByEnd
    OrderBy -->|Desc| Desc
    Collate -->|Desc| Desc
    Desc --> IOrderByEnd
    OrderBy -->|Nulls| Nulls
    Collate -->|Nulls| Nulls
    Asc -->|Nulls| Nulls
    Desc --> |Nulls| Nulls
    Nulls -->|First| First
    First --> IOrderByEnd
    Nulls -->|Last| Last
    Last --> IOrderByEnd
end

ISelect -->|OrderBy| IOrderBy
ISelect -->|Limit| Limit
IOrderBy -->|Limit| Limit
Limit -->|Offset| Offset



Root -->|Insert| Insert
Root -->|Replace| Replace

subgraph IInsert
    Insert -->|Into| Into
    Replace -->|Into| Into
    Insert -->|Or| InsertOr
    InsertOr -->|Abort| Abort
    InsertOr -->|Fail| Fail
    InsertOr -->|Ignore| Ignore
    InsertOr -->|Replace| Replace
    InsertOr -->|Rollback| Rollback
    Abort -->|Into| Into
    Fail -->|Into| Into
    Ignore -->|Into| Into
    Rollback -->|Into| Into

    Into -->|As| IntoAs
    Into -->|Values| InsertValues
    IntoAs -->|Values| InsertValues
    Into -->|Select| InsertSelect
    IntoAs -->|Select| InsertSelect
    Into -->|Default| Default
    IntoAs -->|Default| Default
    Default -->|Values| DefaultValues

    InsertValues --> IInsertEnd
    InsertSelect --> IInsertEnd
    DefaultValues --> IInsertEnd
    IUpsert --> IInsertEnd
end

InsertSelect -->|On| UpsertOn
InsertValues -->|On| UpsertOn

subgraph IUpsert
    UpsertOn -->|Conflict| Conflict
    Conflict -->|Do| UpsertDo
    UpsertDo -->|Nothing| UpsertNothing
    UpsertDo -->|Update|UpsertUpdate
    UpsertUpdate -->|Set| UpsertSet
    UpsertSet -->|Where| UpsertWhere
    UpsertNothing -->|On|UpsertOn
    UpsertSet -->|On|UpsertOn
    UpsertWhere -->|On|UpsertOn

    UpsertNothing --> IUpsertEnd
    UpsertSet --> IUpsertEnd
    UpsertWhere --> IUpsertEnd
end


Returning -->|All|ReturningAll

IUpsert -->|Returning| Returning


Root -->|Delete| Delete

subgraph IDelete
    Delete -->|From| DeleteFrom
    DeleteFrom -->|Where| DeleteWhere
    DeleteFrom -->|Where| DeleteWhereGroup

    DeleteFrom --> IDeleteEnd
    DeleteWhere --> IDeleteEnd
    DeleteWhereGroup --> IDeleteEnd
end

DeleteWhere -->|Returning| Returning
DeleteWhereGroup -->|Returning| Returning